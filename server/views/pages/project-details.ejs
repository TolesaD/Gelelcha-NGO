<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../partials/head', {title: title}) %>
    <style>
        .project-hero {
            height: 400px;
            background-size: cover;
            background-position: center;
            position: relative;
        }
        .project-hero-overlay {
            background: rgba(0, 0, 0, 0.6);
            color: white;
        }
        .progress {
            height: 20px;
        }
        .donation-stats {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
    </style>
</head>
<body>
    <%- include('../partials/header') %>
    
<% if (project) { %>
    <!-- Project Hero Section -->
    <div class="project-hero" style="background-image: url('/uploads/<%= project.image || 'default-project.jpg' %>');">
        <div class="project-hero-overlay h-100 d-flex align-items-center">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8">
                        <h1 class="display-4 fw-bold"><%= project.title %></h1>
                        <p class="lead"><%= project.shortDescription %></p>
                        <span class="badge bg-<%= 
                            project.status === 'completed' ? 'success' : 
                            project.status === 'ongoing' ? 'primary' : 'warning' 
                        %> fs-6">
                            <%= project.status %>
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Content -->
    <section class="py-5">
        <div class="container">
            <div class="row">
                <div class="col-lg-8">
                    <h2 class="mb-4">About This Project</h2>
                    <div class="project-content">
                        <%= project.description ? project.description.replace(/\n/g, '<br>') : 'No description available.' %>
                    </div>

                    <% if (project.gallery && project.gallery.length > 0) { %>
                        <div class="mt-5">
                            <h3 class="mb-4">Project Gallery</h3>
                            <div class="row">
                                <% project.gallery.forEach(image => { %>
                                    <div class="col-md-4 mb-3">
                                        <img src="/uploads/<%= image %>" alt="Project image" 
                                             class="img-fluid rounded shadow" style="height: 200px; object-fit: cover;">
                                    </div>
                                <% }) %>
                            </div>
                        </div>
                    <% } %>
                </div>

                <div class="col-lg-4">
                    <div class="donation-stats">
                        <h4 class="mb-4">Project Status</h4>
                        
                        <% if (project.targetAmount) { %>
                            <div class="progress mb-3">
                                <div class="progress-bar" role="progressbar" 
                                     style="width: <%= Math.min((project.raisedAmount / project.targetAmount * 100), 100) %>%">
                                </div>
                            </div>
                            
                            <div class="row text-center mb-4">
                                <div class="col-6">
                                    <h3 class="text-primary">$<%= project.raisedAmount ? project.raisedAmount.toLocaleString() : '0' %></h3>
                                    <p class="text-muted">Raised</p>
                                </div>
                                <div class="col-6">
                                    <h3 class="text-primary">$<%= project.targetAmount.toLocaleString() %></h3>
                                    <p class="text-muted">Target</p>
                                </div>
                            </div>
                            
                            <div class="text-center mb-4">
                                <div class="display-4 fw-bold text-primary">
                                    <%= Math.min(Math.round((project.raisedAmount || 0) / project.targetAmount * 100), 100) %>%
                                </div>
                                <p class="text-muted">Funded</p>
                            </div>
                        <% } else { %>
                            <p class="text-muted">No funding target set for this project.</p>
                        <% } %>

                        <div class="text-center">
                            <a href="/donate?project=<%= project._id %>" class="btn btn-primary btn-lg w-100 mb-3">
                                <i class="fas fa-donate me-2"></i>Donate Now
                            </a>
                            <a href="/volunteer" class="btn btn-outline-primary w-100">
                                <i class="fas fa-hands-helping me-2"></i>Volunteer
                            </a>
                        </div>
                    </div>

                    <% if (project.impact) { %>
                        <div class="mt-4">
                            <h5>Project Impact</h5>
                            <% if (project.impact.beneficiaries) { %>
                                <p><i class="fas fa-users text-primary me-2"></i> 
                                   <%= project.impact.beneficiaries.toLocaleString() %> beneficiaries</p>
                            <% } %>
                            <% if (project.impact.locations && project.impact.locations.length > 0) { %>
                                <p><i class="fas fa-map-marker-alt text-primary me-2"></i> 
                                   <%= project.impact.locations.join(', ') %></p>
                            <% } %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </section>
<% } else { %>
    <section class="py-5">
        <div class="container text-center">
            <h1>Project Not Found</h1>
            <p class="lead">The project you are looking for does not exist.</p>
            <a href="/projects" class="btn btn-primary">Back to Projects</a>
        </div>
    </section>
<% } %>

    <%- include('../partials/footer') %>
    <%- include('../partials/scripts') %>
</body>
</html>